units           metal
atom_style      atomic
boundary        p p p

# Create atoms (example: FCC copper)
#lattice         fcc 3.615

# Define FCC lattice with copper lattice constant and orientation with 110 along the shock direction
lattice         fcc 3.61158 origin 0.1 0.1 0.1 orient x 1 -1 0 orient y 0 0 -1 orient z 1 1 0

region          box block 0 4 0 4 0 15
create_box      1 box
create_atoms    1 box


## Runtime variables to define the piston velocity, temperature, tstep and frequency of output
variable        tstep  equal 0.0003 
variable        itemp  equal 300 
variable        runEQ equal 2000
variable        mdSteps equal 10000

#piston velocity in Ã…/ps
variable        pistonVeloc equal 10.0
variable        dumpFull equal 5000  
variable        thermoFreq equal 2000

## these variables control the profiling of thermodynamic quantities
variable		BinSize equal 0.1
variable		bin1DFreq equal 1000

variable 		exit equal is_file(STOP)

## Potential specification
pair_style      eam/alloy
pair_coeff      * * Cu_zhou.eam.alloy Cu

timestep 		${tstep}
neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes
thermo  		${thermoFreq}


## compute varibales for profiles and dumps
compute 		ALL_PE all pe                        # Compute total potential energy of system
compute 		SE_ALL all stress/atom NULL virial   # Compute stress on each atom ( [6 x Natom] array )
compute 		PE_ALL all pe/atom                   # Compute potential energy per atom ( [Natom] vector )
compute 		CSymm  all centro/atom 4             # Compute central symmetry parameter ( NearestNeighbor = 12 )
compute 		KE_ALL all ke/atom                   # Compute kinetic energy per atom ( [3 x Natom] array output )


thermo_style    custom step time temp ke pe etotal pxx pyy pzz zlo zhi density
thermo_modify	norm yes


## thermalize sample to ambient conditions
velocity        all create 600 9999
fix             NVT all langevin ${itemp} ${itemp} 0.1 3216548
fix             NPT all nph iso 0 0 $(500.0*dt)
run             ${runEQ}
unfix			NPT
unfix			NVT

## reset box/boundary for shock
fix             NVEs all nve
change_box      all boundary p p s


## piston position and regions for slices
variable		zm equal zlo
variable		pistonPos equal "v_zm - 5.0"


## compute squares of velocity, used in post process to get Tx,Ty,Tz
variable		vx2 atom vx*vx
variable		vy2 atom vy*vy
variable		vz2 atom vz*vz

## use LAMMPS to get thermodynamic quantities in tiny bins, used for post processing later
compute         Chunk2 all chunk/atom bin/1d z 0.0 ${BinSize} units box
fix             prop2 all ave/chunk ${bin1DFreq} 1 ${bin1DFreq} Chunk2 c_KE_ALL c_PE_ALL c_SE_ALL[1] c_SE_ALL[2] c_SE_ALL[3] vx vy vz v_vx2 v_vy2 v_vz2 file profiles.dat


## dump full atomic coordinates
dump 			 Dump4 all custom ${dumpFull} dumps/Cu-shock-*.xyz id type x y z vx vy vz c_SE_ALL[1] c_SE_ALL[2] c_SE_ALL[3] c_PE_ALL c_KE_ALL c_CSymm


## Drive the piston from the left, along Z axis
fix 			wall all wall/piston zlo pos ${pistonPos} vel ${pistonVeloc}  units box
fix 			BAL all balance 2000 1.05 shift z 10 1.05 weight time 1.0
fix 			HALT all halt 20000 v_exit != 0 error soft

run 			${mdSteps}
shell 			"touch END"

